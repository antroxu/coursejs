<html>
   <head>
      <title>
         P&aacute;gina con Javascript.
      </title>
      <script language="javascript">

        var tocado = false;
        var banderaPrimerClick;
        var banderaSegundoClick;
        const N_FILAS = 4;
        const N_COLUMNAS = 4;
        var n_parejas = (N_FILAS * N_COLUMNAS)/2;
        var parejas_encontradas = 0;
        var parejas_que_quedan = n_parejas

        var arrayIndices = [1, 2]
        var arrayBanderas = [1, 1]

        



        function sleep()
        {
            for (var i = 0; i < 10000; i++)
            {
                console.log ("Hola");
            }
        }

               
        function mostrarBandera(bandera)
        {
            bandera.style.visibility = "visible";
        };

        function ocultarBandera(bandera)
        {
            bandera.style.visibility = "hidden";
        };
        
        function ocultarDosBanderas(bandera1, bandera2)
        {
            ocultarBandera(bandera1);
            ocultarBandera(bandera2);
        };       
        
        
        function escribeMensaje(mensaje, id)
        {
            document.getElementById(id).value = mensaje;
        };


        function inicia()
        {
            //Inicializo variables
            tocado = false;
            parejas_encontradas = 0;
            parejas_que_quedan = n_parejas;

            escribeMensaje ("Mensaje de inicio", "cajaMensaje");
            escribeMensaje ("Parejas que quedan: " + parejas_que_quedan, "cajaParejasQueQuedan");
            var lista_tds = document.querySelectorAll("td");
            for (var i = 0; i < lista_tds.length; i++)
                {
                //Programo evento
                lista_tds[i].addEventListener('click', clickBandera);
                //Oculto imagen
                ocultarBandera( lista_tds[i].firstElementChild);
                }
        }

        function clickBandera(evento)
        {
            var estilo = evento.currentTarget.firstElementChild.style.visibility
            // if (!(estilo == 'visible' || estilo == ''))
            if (estilo == 'hidden')
                procesaClick(evento); 
        }


        function procesaClick(evento)
        {
            if (!tocado) //Primer click
            {
                //target, es el elemento tocado
                //currentTarget, es el elemento contenedor
                //obtener elemento tocado
                banderaPrimerClick =  evento.currentTarget.firstElementChild; 
                mostrarBandera(banderaPrimerClick);
                tocado = !tocado;
            }
            else //Segundo click
            {
                banderaSegundoClick =  evento.currentTarget.firstElementChild; 
                mostrarBandera(banderaSegundoClick);
                //alert ("hola");
                if (banderaPrimerClick.src == banderaSegundoClick.src) //Pareja igual
                {
                    parejas_encontradas ++; //Incrmento las parejas encontradas
                    parejas_que_quedan --; //Decremento las parejas que quedan
                    escribeMensaje ("Parejas que quedan: " + parejas_que_quedan, "cajaParejasQueQuedan");
                    if (parejas_encontradas == n_parejas) //FIN
                    {
                        escribeMensaje ("Felicidades, has encontrado todas las parejas", "cajaMensaje");
                        //Como se desprograman eventos de la pareja???
                    }
                    else //Seguimos buscando parejas
                    {
                        tocado = !tocado
                    }
                }    
                else //parejas diferentes
                {
                    //Ocultar imagenes
                    //Retraso de 3 segundos
                    //var timeoutID = window.setTimeout(func_nada, 1000);
                    //sleep();
                    ocultarDosBanderas(banderaPrimerClick, banderaSegundoClick);
                    tocado = !tocado
                }
                
            }
        }
      </script>
   </head>
   <body>
        <table border = 1>
            <tr>
                <td><img src="bandera5.png"></td>
                <td><img src="bandera2.png"></td>
                <td><img src="bandera6.png"></td>
                <td><img src="bandera6.png"></td>
            </tr>
            <tr>
                <td><img src="bandera1.png"></td>
                <td><img src="bandera5.png"></td>
                <td><img src="bandera8.png"></td>
                <td><img src="bandera7.png"></td>
            </tr>
            <tr>
                <td><img src="bandera3.png"></td>
                <td><img src="bandera7.png"></td>
                <td><img src="bandera2.png"></td>
                <td><img src="bandera4.png"></td>
            </tr>
            <tr>
                <td><img src="bandera8.png"></td>
                <td><img src="bandera1.png"></td>
                <td><img src="bandera3.png"></td>
                <td><img src="bandera4.png"></td>
            </tr>
        </table>

        <br>
        <br>

        <input type="text" id="cajaMensaje" size=50> </input>
        <br>
        <br>
        <input type="text" id="cajaParejasQueQuedan" size=50> </input>
        <br>
        <br>
        <button type="button" onclick="inicia()">Click para empezar el juego!</button>

   </body>
</html>
